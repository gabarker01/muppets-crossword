<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Muppet Christmas Carol Cryptic Crossword</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <div class="grid-container">
      <div class="title">The Muppet Christmas Carol<br>Cryptic Crossword</div>
      <div class="grid" tabindex="0"></div> <!-- Make grid focusable -->
    </div>
  
    <div id="clues">
      <!-- Across Clues -->
      <div class="section" id="across-section">
        <h2>Across</h2>
        <ul id="across-clue-list"></ul>
        <button id="check-button">Check Words</button>
      </div>
  
      <!-- Down Clues -->
      <div class="section" id="down-section">
        <h2>Down</h2>
        <ul id="down-clue-list"></ul>
        <button id="name-button">Made by<br>George Barker</button>
      </div>
    </div>
  </div>

  <script>
const gridContainer = document.querySelector('.grid');
const acrossClueList = document.getElementById('across-clue-list');
const downClueList = document.getElementById('down-clue-list');
const checkButton = document.getElementById('check-button');
const rows = 14;
const cols = 17;
const clues = [];

// Create grid cells dynamically
for (let row = 0; row < rows; row++) {
  for (let col = 0; col < cols; col++) {
    const cell = document.createElement('div');
    cell.id = `cell-${row}-${col}`;
    cell.className = 'cell white';
    cell.contentEditable = true;
    cell.setAttribute('data-row', row);
    cell.setAttribute('data-col', col);

    cell.addEventListener('input', (e) => {
  const content = e.target.textContent.toUpperCase().slice(0, 1);
  e.target.textContent = content;

  // Determine the direction based on yellow-highlighted neighboring cells
  const nextRightCell = document.querySelector(`#cell-${row}-${col + 1}`);
  const nextDownCell = document.querySelector(`#cell-${row + 1}-${col}`);
  let nextCell = null;

  if (nextRightCell?.classList.contains('yellow')) {
    // If the next right cell is highlighted, it's an Across clue
    nextCell = nextRightCell;
  } else if (nextDownCell?.classList.contains('yellow')) {
    // If the next down cell is highlighted, it's a Down clue
    nextCell = nextDownCell;
  }

  // Move the cursor to the next cell
  if (nextCell && content) nextCell.focus();
});


    gridContainer.appendChild(cell);
  }
}

// Highlight cells in yellow
function highlightWord(cellIds) {
  document.querySelectorAll('.cell').forEach(cell => {
    if (!cell.classList.contains('black')) cell.className = 'cell white';
  });
  cellIds.forEach(id => document.getElementById(id)?.classList.add('yellow'));
}

// Focus on the first cell of a word
function focusFirstCell(cellId) {
  document.getElementById(cellId)?.focus();
}

// Highlight word and bold associated clue
function highlightWordAndBoldClue(matchedClue) {
  highlightWord(matchedClue.cells);
  

  // Reset all clues to normal font weight
  document.querySelectorAll('.clue-item').forEach(item => (item.style.fontWeight = 'normal'));

  // Bold the corresponding clue
  const clueItems = document.querySelectorAll('.clue-item');
  const clueItem = Array.from(clueItems).find(item => item.textContent.includes(matchedClue.clue));
  if (clueItem) {
    clueItem.style.fontWeight = 'bold';
  }
}

// Attach event listeners to cells
document.querySelectorAll('.cell').forEach(cell => {
  cell.addEventListener('click', (e) => {
    const clickedCell = e.target;

    // Find the clue associated with the clicked cell
    const matchedClue = clues.find(({ cells }) => cells.includes(clickedCell.id));

    if (matchedClue) {
      highlightWordAndBoldClue(matchedClue);
      
    }
  });
});

// Function to create a cell for the clue number (non-editable) and letter input (editable)
function makeClueCellWithInput(row, col, clueNumber) {
  const containerCell = document.createElement('div');
  containerCell.classList.add('cell', 'container-cell');  // Wrapper cell for the number and letter input
  
  const clueNumberCell = document.createElement('div');
  clueNumberCell.classList.add('clue-number-cell');
  clueNumberCell.textContent = clueNumber;
  
  const letterInput = document.createElement('input');
  letterInput.classList.add('letter-input');
  letterInput.setAttribute('maxlength', 1);  // Only one letter allowed

  containerCell.appendChild(clueNumberCell);
  containerCell.appendChild(letterInput);

  return containerCell;
}

function makeWord(startId, word, clue, number, direction) {
  const [_, startRow, startCol] = startId.match(/cell-(\d+)-(\d+)/).map(Number);
  const wordCells = [];
  
  for (let i = 0; i < word.length; i++) {
    const cellId = direction === 'across' 
      ? `cell-${startRow}-${startCol + i}` 
      : `cell-${startRow + i}-${startCol}`;

    const cell = document.getElementById(cellId);
    if (!cell) return console.warn('Word exceeds grid boundaries.');

    wordCells.push(cellId);

    // Set the clue number on the first cell of the word
    if (i === 0) {
      cell.dataset.number = number; // Add the number to the cell
    }

    // Ensure all cells are editable
    cell.contentEditable = true;
    cell.classList.add('white');
  }
  
  // Add the clue to the list
  clues.push({ word, clue, cells: wordCells });

  const clueItem = document.createElement('li');
  clueItem.classList.add('clue-item');
  clueItem.textContent = `${number}. ${clue}`;
  clueItem.addEventListener('click', () => {
    highlightWordAndBoldClue({ word, clue, cells: wordCells });
    focusFirstCell(wordCells[0]);
  });

  if (direction === 'across') {
    acrossClueList.appendChild(clueItem);
  } else {
    downClueList.appendChild(clueItem);
  }
}



makeWord("cell-0-2", "DIMWIT", "At first, inserted couple in “the Marleys were dead, to begin with” confused a fool (6)", 1, 'down');
makeWord("cell-2-4", "STATLER", "Saint, confusingly, later became a heckler (7)", 3, 'down');
makeWord("cell-4-1", "DISAPPROVAL", "Dislike of misquoting, initially vulgarly and very quiet, as “the Italian way?” (11)", 4, 'across');
makeWord("cell-4-16", "CAINE", "Cockney ain’t short in church (5)", 5, 'down');
makeWord("cell-8-12", "BELLE", "Ring announced for fiancé (5)", 8, 'across');
makeWord("cell-10-7", "TINYTIM", "A dishevelled character starting to thrive, I rediscovered a clean smell (4,3)", 9, 'across');
makeWord("cell-11-0", "MARLEYS", "Businessmen are suspiciously early in Colin’s shop? (7)", 10, 'across');
makeWord("cell-0-10", "UNSEAWORTHY", "Not ship-shape, at sea, nor “the American way!” (11)", 2, 'down');
makeWord("cell-8-2", "SPIRIT", "The crisp I ritually ate gave me vitality (6)", 7, 'down');
makeWord("cell-8-2", "SCROOGE", "Marsupial between scenic banks and odd glen became a second father to Tiny Tim (7)", 7, 'across');
makeWord("cell-7-13", "KERMIT", "Immortal bird engulfs stuttering Mr Cratchit (6)", 6, 'down');






// Mark unused cells as black
function markUnusedCells() {
  document.querySelectorAll('.cell').forEach(cell => {
    const isUsed = clues.some(clue => clue.cells.includes(cell.id));
    if (!isUsed) cell.classList.replace('white', 'black');
  });
}
markUnusedCells();

// Add event listener for arrow key navigation
gridContainer.addEventListener('keydown', (e) => {
      const activeElement = document.activeElement;

      if (activeElement.classList.contains('cell')) {
        const row = parseInt(activeElement.getAttribute('data-row'), 10);
        const col = parseInt(activeElement.getAttribute('data-col'), 10);

        let nextCell;
        if (e.key === 'ArrowUp' && row > 0) {
          nextCell = document.querySelector(`#cell-${row - 1}-${col}`);
        } else if (e.key === 'ArrowDown' && row < rows - 1) {
          nextCell = document.querySelector(`#cell-${row + 1}-${col}`);
        } else if (e.key === 'ArrowLeft' && col > 0) {
          nextCell = document.querySelector(`#cell-${row}-${col - 1}`);
        } else if (e.key === 'ArrowRight' && col < cols - 1) {
          nextCell = document.querySelector(`#cell-${row}-${col + 1}`);
        }

        if (nextCell) {
          e.preventDefault(); // Prevent the cursor from moving within the text
          nextCell.focus();
        }
      }
    });

// Check words on button click
checkButton.addEventListener('click', () => {
  clues.forEach(({ word, cells }) => {
    const isCorrect = cells.every((cellId, index) =>
      document.getElementById(cellId)?.textContent === word[index]
    );
    cells.forEach(cellId => {
      const cell = document.getElementById(cellId);
      if (cell) cell.classList.toggle('green', isCorrect);
    });
  });
});

  </script>
</body>
</html>
